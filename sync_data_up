LOCAL=$HOME/data/*
SSH=/usr/bin/ssh
KEY=$HOME/.ssh/id_rsa
REMOTE=$HOME/data

die () {
	echo >&2 "$@"
	exit 1
}

# Set the host to synchronize with, from the first argument
# If not given, synchronize with fwnc7111 by default
[ "$#" -lt 2 ] || die "At most one argument, $# given"
[ "$#" -eq 1 ] && SERVER=$1 || case `hostname` in
	fwnc7111)
		SERVER=poly
		;;
	niuma)
		SERVER=linda
		;;
	piuma)
		SERVER=linda
		;;
	rubato)
		SERVER=cartman
		;;
	*)
		SERVER=fwnc7111
		;;
esac
echo "Synchronizing with $SERVER ..."

# Options to use
OPTIONS="--verbose --progress --stats --human-readable --archive --compress --update --delete"

# Exclude some files
EXCLUDE="--exclude "personal/private/" --exclude "*.backup" --exclude "*.bak" --exclude "*~" --exclude "*.pyc""

# The actual synchronization
rsync $OPTIONS $EXCLUDE --rsh="$SSH -i $KEY" $LOCAL $USER@$SERVER:$REMOTE

